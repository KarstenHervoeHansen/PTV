A51 MACRO ASSEMBLER      HINT                                                                DATE  28/07/98   PAGE     1


MS-DOS MACRO ASSEMBLER A51 V4.4 
OBJECT MODULE PLACED IN HINT.OBJ
ASSEMBLER INVOKED BY:  A51 HINT.A DEBUG

LOC  OBJ            LINE     SOURCE

                       1     
                       2     ;********************************************************************
                       3     ;* Project      : PT5210  Time Code Converter
                       4     ;* Filename     : HINT.A
                       5     ;* Version      : 1.1
                       6     ;* Purpose      : H-Interrupt handling
                       7     ;* Org.date     : 960903
                       8     ;* Author       : PRC
                       9     ;********************************************************************
                      10     ;HISTORY:
                      11     ;970xxx RELEASED 1.1
                      12     ;970127 Added table for M-system.
                      13     
                      14     HCOUNT  SEGMENT CODE
                      15     ;       PT5210 Timecode Unit
                      16     ; File:         wint.c          word-interrupt
                      17     ; Version:      0.0
                      18     ; Author:       PRC
                      19     ; HISTORY:
                      20     
                      21     ; 961211 KILL inverted
                      22     ; 960717 translated from PM5655, hint.a
                      23     
                      24     EXTRN DATA      (slice, wordno, readbuf)
                      25     EXTRN CODE      (linecountg, linecountm)
                      26     ;EXTRN XDATA    (port1tab, port2tab)
                      27     extrn bit       (load1, load2, found, done)
                      28     
  0093                29     locked  equ     P1.3
  0094                30     enable  equ     P1.4
  0095                31     kill    equ     P1.5
  0097                32     clear   equ     P1.7
  00B0                33     crc     equ     P3.0
  00B1                34     window  equ     P3.1
  00B2                35     tenbit  equ     P3.2
  00B5                36     gsys    equ     P3.5
  0090                37     readport equ    P1
                      38     
                      39     
                      40     CSEG AT 000BH
000B 020000   F       41     ljmp    hint
                      42     
                      43     
----                  44     RSEG    HCOUNT
                      45     
0000                  46     hint:
0000 C2B1             47             clr     window          ;reset counters
                      48     ;       nop                     ;delay untill after burst
                      49     ;       nop
                      50     ;       nop
0002 D2B1             51             setb    window          ;start search
                      52     
0004 20B008           53             jb      crc,badcrc      ;test CRC
0007 C2B1             54             clr     window          ;CRC was good, stop counters
A51 MACRO ASSEMBLER      HINT                                                                DATE  28/07/98   PAGE     2


LOC  OBJ            LINE     SOURCE

0009 D200     F       55             setb    found           ;good CRC
000B C200     F       56             clr     done            ;set flag for new data
000D 800B             57             sjmp    nxtlin
000F                  58     badcrc:
                      59     ;       clr     window          ;reset counters
                      60     ;       setb    window          ;start search
000F 300004   F       61             jnb     found,clrreg
0012 C2B1             62             clr     window          ;was already found, stop counters
0014 8004             63             sjmp    nxtlin
0016                  64     clrreg:
0016 D297             65             setb    clear           ;reset FIFO-reg.
0018 C297             66             clr     clear
                      67     
001A                  68     nxtlin:
001A C0E0             69             PUSH    ACC
001C C0D0             70             PUSH    PSW
001E C083             71             PUSH    DPH
0020 C082             72             PUSH    DPL
                      73     
0022 75D008           74             MOV     PSW,#08H
                      75     
0025 0500     F       76             inc     slice
                      77     
                      78             ; TL0= linecount[slice<<1];
0027 E500     F       79             mov     a,slice
0029 23               80             rl      a
002A F8               81             mov     r0,a
002B 30B505           82             jnb     gsys, msys
002E 900000   F       83             mov     dptr,#linecountg
0031 8003             84             sjmp    setit
0033                  85     msys:
0033 900000   F       86             mov     dptr,#linecountm
0036                  87     setit:
0036 93               88             movc    a,@a+dptr
0037 F58A             89             mov     TL0,a
                      90             ; TH0= linecount[(slice<<1) + 1];
0039 08               91             inc     r0
003A E8               92             mov     a,r0
003B 93               93             movc    a,@a+dptr
003C F58C             94             mov     TH0,a
003E                  95     tstslice:
                      96             ; if (slice==18)  window= 0;
003E E500     F       97             mov     a,slice
0040 B41206           98             cjne    a,#18,tst36
0043 C2B1             99             clr     window
0045 D200     F      100             setb    load2
0047 8011            101             sjmp    outtim0
0049                 102     tst36:
                     103             ; if (slice>35) { window= 0; TR0= 0;}
0049 B4230E          104             cjne    a,#35,outtim0
004C C2B1            105             clr     window
004E D200     F      106             setb    load1
0050 A200     F      107             mov     c,found         ;cut off if bad input
0052 8293            108             anl     c,locked        ; or if not in lock
0054 8294            109             anl     c,enable        ; or if not enabled
                     110     ;       cpl     c
0056 9295            111             mov     kill,c
0058                 112     stop:
0058 C28C            113             clr     TR0
A51 MACRO ASSEMBLER      HINT                                                                DATE  28/07/98   PAGE     3


LOC  OBJ            LINE     SOURCE

005A                 114     outtim0:
005A D082            115             POP     DPL
005C D083            116             POP     DPH
005E D0D0            117             POP     PSW
0060 D0E0            118             POP     ACC
0062 32              119             RETI    
                     120     
                     121     end
A51 MACRO ASSEMBLER      HINT                                                                DATE  28/07/98   PAGE     4


SYMBOL TABLE LISTING
------ ----- -------


N A M E     T Y P E  V A L U E   ATTRIBUTES

ACC. . . .  D ADDR   00E0H   A
BADCRC . .  C ADDR   000FH   R        SEG=HCOUNT
CLEAR. . .  B ADDR   0090H.7 A
CLRREG . .  C ADDR   0016H   R        SEG=HCOUNT
CRC. . . .  B ADDR   00B0H.0 A
DONE . . .  B ADDR   ----        EXT
DPH. . . .  D ADDR   0083H   A
DPL. . . .  D ADDR   0082H   A
ENABLE . .  B ADDR   0090H.4 A
FOUND. . .  B ADDR   ----        EXT
GSYS . . .  B ADDR   00B0H.5 A
HCOUNT . .  C SEG    0000H            REL=UNIT
HINT . . .  C ADDR   0000H   R        SEG=HCOUNT
KILL . . .  B ADDR   0090H.5 A
LINECOUNTG  C ADDR   ----        EXT
LINECOUNTM  C ADDR   ----        EXT
LOAD1. . .  B ADDR   ----        EXT
LOAD2. . .  B ADDR   ----        EXT
LOCKED . .  B ADDR   0090H.3 A
MSYS . . .  C ADDR   0033H   R        SEG=HCOUNT
NXTLIN . .  C ADDR   001AH   R        SEG=HCOUNT
OUTTIM0. .  C ADDR   005AH   R        SEG=HCOUNT
P1 . . . .  D ADDR   0090H   A
P3 . . . .  D ADDR   00B0H   A
PSW. . . .  D ADDR   00D0H   A
READBUF. .  D ADDR   ----        EXT
READPORT .  D ADDR   0090H   A
SETIT. . .  C ADDR   0036H   R        SEG=HCOUNT
SLICE. . .  D ADDR   ----        EXT
STOP . . .  C ADDR   0058H   R        SEG=HCOUNT
TENBIT . .  B ADDR   00B0H.2 A
TH0. . . .  D ADDR   008CH   A
TL0. . . .  D ADDR   008AH   A
TR0. . . .  B ADDR   0088H.4 A
TST36. . .  C ADDR   0049H   R        SEG=HCOUNT
TSTSLICE .  C ADDR   003EH   R        SEG=HCOUNT
WINDOW . .  B ADDR   00B0H.1 A
WORDNO . .  D ADDR   ----        EXT


REGISTER BANK(S) USED: 0

ASSEMBLY COMPLETE, NO ERRORS FOUND
