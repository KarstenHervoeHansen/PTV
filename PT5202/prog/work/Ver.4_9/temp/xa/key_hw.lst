XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   1
F:\PT5202\prog\work\Ver.4_9\temp\xa\key_hw.src
ADDR   CODE            LINE SOURCELINE
                          1 ; XA C compiler v2.0 r2                   SN00085795-Ccz (c) 1998 TASKING, Inc.
                          2 ; options: -A1 -Cxag3 -e -g -IcF:\PT5202\prog\include
                          3 ;          -IF:\PT5202\prog\rtxc\xa\include -I. -Ml -O2 -s
                          5 $NOZPAGE
                          6         NAME    KEY_HW
                         10 ; key_hw.c    1 /****************************************************************************/
                         11 ; key_hw.c    2 /* MODULE:                                                                  */
                         12 ; key_hw.c    3 /*  key_hw.c - Keyboard driver                                              */
                         13 ; key_hw.c    4 /****************************************************************************/
                         14 ; key_hw.c    5 /* FUNCTIONS:                                                               */
                         15 ; key_hw.c    6 /*                                                                          */
                         16 ; key_hw.c    7 /*      int KeyboardGet( UC *scancode);                                          
                                                                                                                             
                                                    */
                         17 ; key_hw.c    8 /*                                                                          */
                         18 ; key_hw.c    9 /* TASKS:                                                                   */
                         19 ; key_hw.c   10 /*                                                                          */
                         20 ; key_hw.c   11 /* NOTES:                                                                   */
                         21 ; key_hw.c   12 /*                                                                          */
                         22 ; key_hw.c   13 /****************************************************************************/
                         23 ; key_hw.c   14 /*
                         24 ; key_hw.c   15  *   PTV software for PT5201    
                         25 ; key_hw.c   16  *   Copyright (c) 
                         26 ; key_hw.c   17  *   ProTeleVision Technologies A/S.
                         27 ; key_hw.c   18  *   ALL RIGHTS RESERVED
                         28 ; key_hw.c   19 */
                         29 ; key_hw.c   20 /****************************************************************************/
                         30 ; key_hw.c   21 #include "reg8051.h"
                         33 ; key_hw.c   22 #include "define.h"        // Standard PTV defines
                         36 ; key_hw.c   23 #include "key_hw.h"
                         39 ; key_hw.c   24 #include "keycodes.h"
                         42 ; key_hw.c   25 
                         43 ; key_hw.c   26 volatile UI PushButtonPort _at(0x6a010);        // Port defined in PLD
                         44 ; key_hw.c   27 
                         45 ; key_hw.c   28 /**************************************************************************/
                         46 ; key_hw.c   29 /* KeyboardGet                                                                   
                                                                                                                             
                                                       KEY_HW.C     */
                         47 ; key_hw.c   30 /*                                                                               
                                                                                                                             
                                                                                                                             
                                            */
                         48 ; key_hw.c   31 /* Author:       Kim Engedahl, DEV, 000208                                       
                                                                                                                             
                                    */
                         49 ; key_hw.c   32 /* Revised:      000321, KEn, DEV                                                
                                                                                                                             
                                            */
                         50 ; key_hw.c   33 /*                                                                               
                                                                                                                             
                                                                                                                             
                                            */
                         51 ; key_hw.c   34 /* Function:                                                                     
                                                                                                                             
                                                                                                    */
                         52 ; key_hw.c   35 /* Remarks:                                                                      
                                                                                                                             
                                                                                                                    */
                         53 ; key_hw.c   36 /* Returns:                                                                      
                                                                                                                             
                                                                                                                    */
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   2

ADDR   CODE            LINE SOURCELINE
                         54 ; key_hw.c   37 /* Updates:                                                                      
                                                                                                                             
                                                                                                                    */
                         55 ; key_hw.c   38 /**************************************************************************/
                         56 ; key_hw.c   39 int KeyboardGet( UC *scancode)
                         57 ; key_hw.c   40 {
000000                   58 KEY_HW_PR       SEGMENT HCODE
000000                   59         RSEG    KEY_HW_PR
                         60         ALIGN   1
                         62         PUBLIC  _KeyboardGet
000000                   63 _KeyboardGet:
                         71 ; key_hw.c   41         if ( PushButtonPort & 0x01)
000000 96484206          73         MOV.B   ES,#SEG( _PushButtonPort )
000004 9928A010          74         MOV.W   R2,#SOF( _PushButtonPort )
000008 8A22              75         MOV.W   R2,[R2]
00000A 99250001          76         AND.W   R2,#01H
00000E F304              77         BEQ     _3
                         78 ; key_hw.c   42                 *scancode = KeyNone;
000010 862C42            80         MOV.B   ES,R1L
000013 9208FF            81         MOV.B   [R0],#0FFH
000016 FE03              82         BR      _4
000016 FE03              82         BR      _4
000018                   83 _3:
                         86 ; key_hw.c   43         else
                         87 ; key_hw.c   44                 *scancode = KeyExecute;
000018 862C42            89         MOV.B   ES,R1L
00001B 9208CF            90         MOV.B   [R0],#0CFH
00001B 9208CF            90         MOV.B   [R0],#0CFH
00001E                   91 _4:
                         92 ; key_hw.c   45 
                         93 ; key_hw.c   46         return( OK);
00001E 9908FFFF          95         MOV.W   R0,#0FFFFH
                         97 ; key_hw.c   47 }
000022 D680              99         RET
06A010                  105         HSEG AT 06A010H
                        106         PUBLIC  _PushButtonPort
                        107         ALIGN   1
06A010                  108 _PushButtonPort:        DS      2
   |  RESERVED             
06A011
                        109         EXTRN   DATA(__lc_ub_xvwbuffer)
                        110         EXTRN   DATA(__lc_ue_xvwbuffer)
