XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   1
F:\PT5202\prog\work\Ver.4_9\temp\xa\ptvmain.src
ADDR   CODE            LINE SOURCELINE
                          1 ; XA C compiler v2.0 r2                   SN00085795-Ccz (c) 1998 TASKING, Inc.
                          2 ; options: -A1 -Cxag3 -e -g -IcF:\PT5202\prog\include
                          3 ;          -IF:\PT5202\prog\rtxc\xa\include -I. -Ml -O2 -s
                          5 $NOZPAGE
                          6         NAME    PTVMAIN
                         10 ; ptvmain.c    1        /************************************************************************
                            ****/
                         11 ; ptvmain.c    2        /* MODULE:                                                               
                               */
                         12 ; ptvmain.c    3        /*   ptvmain.c - ptvmain module for PTV software.                        
                               */
                         13 ; ptvmain.c    4        /************************************************************************
                            ****/
                         14 ; ptvmain.c    5        /* FUNCTIONS:                                                            
                               */
                         15 ; ptvmain.c    6                void ptvmain(void);
                         16 ; ptvmain.c    7        /*                                                                       
                               */
                         17 ; ptvmain.c    8        /*                                                                       
                               */
                         18 ; ptvmain.c    9        /* TASKS:                                                                
                               */
                         19 ; ptvmain.c   10        /*                                                                       
                               */
                         20 ; ptvmain.c   11        /* NOTES:                                                                
                               */
                         21 ; ptvmain.c   12        /*      ptvmain is the main function for PTV software called by main.    
                               */
                         22 ; ptvmain.c   13        /*      The use of ptvmain function to start software is enabled in      
                               */
                         23 ; ptvmain.c   14        /*      sysopts.h.                                                       
                               */
                         24 ; ptvmain.c   15        /************************************************************************
                            ****/
                         25 ; ptvmain.c   16        /*
                         26 ; ptvmain.c   17         *   PTV software for PT5201
                         27 ; ptvmain.c   18         *   Copyright (c) 
                         28 ; ptvmain.c   19         *   ProTeleVision Technologies A/S.
                         29 ; ptvmain.c   20         *   ALL RIGHTS RESERVED
                         30 ; ptvmain.c   21        */
                         31 ; ptvmain.c   22        /************************************************************************
                            ****/
                         32 ; ptvmain.c   23        
                         33 ; ptvmain.c   24        
                         34 ; ptvmain.c   25        #include "define.h"
                         37 ; ptvmain.c   26        #include "rtxcobj.h"
                        367 ; ptvmain.c   27        #include "instru.h"
                        471 ; ptvmain.c   28        #include "rs232.h"
                        478 ; ptvmain.c   29        
                        479 ; ptvmain.c   30        
                        480 ; ptvmain.c   31        void ptvmain(void)
                        481 ; ptvmain.c   32        {
000000                  482 PTVMAIN_PR      SEGMENT HCODE
000000                  483         RSEG    PTVMAIN_PR
                        484         ALIGN   1
                        486         PUBLIC  _ptvmain
000000                  487 _ptvmain:
000000 0F30             491         PUSH.W  R4, R5
                        493 ; ptvmain.c   33        /* VAR */
                        494 ; ptvmain.c   34        
                        495 ; ptvmain.c   35        /*BEGIN */
                        496 ; ptvmain.c   36         InstrumentControl = newTThread( 15, Instrument_Control_Task);
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   2

ADDR   CODE            LINE SOURCELINE
000002 9908000F         498         MOV.W   R0,#0FH
000006 9938rrrr         499         MOV.W   R3,#SEG( _Instrument_Control_Task )
00000A 9928rrrr         500         MOV.W   R2,#SOF( _Instrument_Control_Task )
                        501         CALL    _newTThread
00000E C4rrrrrr        +501 ;       FCALL   _newTThread
000012 964842rr         502         MOV.B   ES,#SEG( _InstrumentControl )
000016 9928rrrr         503         MOV.W   R2,#SOF( _InstrumentControl )
00001A 8B0A             504         MOV.W   [R2+],R0
00001C 8A1A             505         MOV.W   [R2],R1
                        506 ; ptvmain.c   37         InstrumentControl->Execute( InstrumentControl);
00001E 862C42           508         MOV.B   ES,R1L
000021 8C4006           509         MOV.W   R4,[R0+6]
000024 8C5008           510         MOV.W   R5,[R0+8]
000027 C4rrrrrr         511         FCALL   __ICALL
                        512 ; ptvmain.c   38        }
00002B 2F30             514         POP.W   R4, R5
00002D D680             516         RET
                        518 ; ptvmain.c   39        
                        519 ; ptvmain.c   40        
                        520 ; ptvmain.c   41        void ptvend(void)
                        521 ; ptvmain.c   42        {
00002F 00               522         ALIGN   1
                        524         PUBLIC  _ptvend
000030                  525 _ptvend:
                        529 ; ptvmain.c   43        /* VAR */
                        530 ; ptvmain.c   44        
                        531 ; ptvmain.c   45        /*BEGIN */
                        532 ; ptvmain.c   46        
                        533 ; ptvmain.c   47         deleteTThread( InstrumentControl);
000030 964842rr         535         MOV.B   ES,#SEG( _InstrumentControl )
000034 9918rrrr         536         MOV.W   R1,#SOF( _InstrumentControl )
000038 8B01             537         MOV.W   R0,[R1+]
00003A 8A11             538         MOV.W   R1,[R1]
                        539         CALL    _deleteTThread
00003C C4rrrrrr        +539 ;       FCALL   _deleteTThread
                        540 ; ptvmain.c   48        
                        541 ; ptvmain.c   49         rs232_stop();
                        543         CALL    _rs232_stop
000040 C4rrrrrr        +543 ;       FCALL   _rs232_stop
                        544 ; ptvmain.c   50        }
000044 D680             546         RET
                        552         EXTRN   HCODE(_rs232_stop)
                        556         EXTRN   HDATA(_InstrumentControl)
                        559         EXTRN   HCODE(_deleteTThread)
                        562         EXTRN   HCODE(_Instrument_Control_Task)
                        563         EXTRN   HCODE(__ICALL)
                        569         EXTRN   HCODE(_newTThread)
                        570         EXTRN   DATA(__lc_ub_xvwbuffer)
                        571         EXTRN   DATA(__lc_ue_xvwbuffer)
                        572         CALLS   'ptvmain', 'newTThread'
                        573         CALLS   'ptvend', 'deleteTThread'
                        574         CALLS   'ptvend', 'rs232_stop'
