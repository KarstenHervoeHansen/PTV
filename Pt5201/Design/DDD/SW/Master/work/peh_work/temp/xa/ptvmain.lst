XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   1
F:\PTV\Pt5201\Design\DDD\SW\Master\work\peh_work\temp\xa\ptvmain.src
ADDR   CODE            LINE SOURCELINE
                          1 ; XA C compiler v2.0 r2                   SN00085795-Ccz (c) 1998 TASKING, Inc.
                          2 ; options: -A1 -Cxag3 -e -g -Ic:\cxa\include -Ic:\cxa\rtxc\xa\include -I. -Ml
                          3 ;          -O2 -s
                          5 $NOZPAGE
                          6         NAME    PTVMAIN
                         10 ; ptvmain.c    1        /************************************************************************
                            ****/
                         11 ; ptvmain.c    2        /* MODULE:                                                               
                               */
                         12 ; ptvmain.c    3        /*   ptvmain.c - ptvmain module for PTV software.                        
                               */
                         13 ; ptvmain.c    4        /************************************************************************
                            ****/
                         14 ; ptvmain.c    5        /* FUNCTIONS:                                                            
                               */
                         15 ; ptvmain.c    6                void ptvmain(void);
                         16 ; ptvmain.c    7        /*                                                                       
                               */
                         17 ; ptvmain.c    8        /*                                                                       
                               */
                         18 ; ptvmain.c    9        /* TASKS:                                                                
                               */
                         19 ; ptvmain.c   10        /*                                                                       
                               */
                         20 ; ptvmain.c   11        /* NOTES:                                                                
                               */
                         21 ; ptvmain.c   12        /*      ptvmain is the main function for PTV software called by main.    
                               */
                         22 ; ptvmain.c   13        /*      The use of ptvmain function to start software is enabled in      
                               */
                         23 ; ptvmain.c   14        /*      sysopts.h.                                                       
                               */
                         24 ; ptvmain.c   15        /************************************************************************
                            ****/
                         25 ; ptvmain.c   16        /*
                         26 ; ptvmain.c   17         *   PTV software for PT5201
                         27 ; ptvmain.c   18         *   Copyright (c) 
                         28 ; ptvmain.c   19         *   ProTeleVision Technologies A/S.
                         29 ; ptvmain.c   20         *   ALL RIGHTS RESERVED
                         30 ; ptvmain.c   21        */
                         31 ; ptvmain.c   22        /************************************************************************
                            ****/
                         32 ; ptvmain.c   23        
                         33 ; ptvmain.c   24        
                         34 ; ptvmain.c   25        #include "define.h"
                         37 ; ptvmain.c   26        #include "rtxcobj.h"
                        367 ; ptvmain.c   27        #include "instru.h"
                        470 ; ptvmain.c   28        #include "rs232.h"
                        477 ; ptvmain.c   29        
                        478 ; ptvmain.c   30        
                        479 ; ptvmain.c   31        void ptvmain(void)
                        480 ; ptvmain.c   32        {
000000                  481 PTVMAIN_PR      SEGMENT HCODE
000000                  482         RSEG    PTVMAIN_PR
                        483         ALIGN   1
                        485         PUBLIC  _ptvmain
000000                  486 _ptvmain:
000000 0F30             490         PUSH.W  R4, R5
                        492 ; ptvmain.c   33        /* VAR */
                        493 ; ptvmain.c   34        
                        494 ; ptvmain.c   35        /*BEGIN */
                        495 ; ptvmain.c   36         InstrumentControl = newTThread( 15, Instrument_Control_Task);
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   2

ADDR   CODE            LINE SOURCELINE
000002 9908000F         497         MOV.W   R0,#0FH
000006 9938rrrr         498         MOV.W   R3,#SEG( _Instrument_Control_Task )
00000A 9928rrrr         499         MOV.W   R2,#SOF( _Instrument_Control_Task )
                        500         CALL    _newTThread
00000E C4rrrrrr        +500 ;       FCALL   _newTThread
000012 964842rr         501         MOV.B   ES,#SEG( _InstrumentControl )
000016 9928rrrr         502         MOV.W   R2,#SOF( _InstrumentControl )
00001A 8B0A             503         MOV.W   [R2+],R0
00001C 8A1A             504         MOV.W   [R2],R1
                        505 ; ptvmain.c   37         InstrumentControl->Execute( InstrumentControl);
00001E 862C42           507         MOV.B   ES,R1L
000021 8C4006           508         MOV.W   R4,[R0+6]
000024 8C5008           509         MOV.W   R5,[R0+8]
000027 C4rrrrrr         510         FCALL   __ICALL
                        511 ; ptvmain.c   38        }
00002B 2F30             513         POP.W   R4, R5
00002D D680             515         RET
                        517 ; ptvmain.c   39        
                        518 ; ptvmain.c   40        
                        519 ; ptvmain.c   41        void ptvend(void)
                        520 ; ptvmain.c   42        {
00002F 00               521         ALIGN   1
                        523         PUBLIC  _ptvend
000030                  524 _ptvend:
                        528 ; ptvmain.c   43        /* VAR */
                        529 ; ptvmain.c   44        
                        530 ; ptvmain.c   45        /*BEGIN */
                        531 ; ptvmain.c   46        
                        532 ; ptvmain.c   47         deleteTThread( InstrumentControl);
000030 964842rr         534         MOV.B   ES,#SEG( _InstrumentControl )
000034 9918rrrr         535         MOV.W   R1,#SOF( _InstrumentControl )
000038 8B01             536         MOV.W   R0,[R1+]
00003A 8A11             537         MOV.W   R1,[R1]
                        538         CALL    _deleteTThread
00003C C4rrrrrr        +538 ;       FCALL   _deleteTThread
                        539 ; ptvmain.c   48        
                        540 ; ptvmain.c   49         rs232_stop();
                        542         CALL    _rs232_stop
000040 C4rrrrrr        +542 ;       FCALL   _rs232_stop
                        543 ; ptvmain.c   50        }
000044 D680             545         RET
                        551         EXTRN   HCODE(_rs232_stop)
                        555         EXTRN   HDATA(_InstrumentControl)
                        558         EXTRN   HCODE(_deleteTThread)
                        561         EXTRN   HCODE(_Instrument_Control_Task)
                        562         EXTRN   HCODE(__ICALL)
                        568         EXTRN   HCODE(_newTThread)
                        569         EXTRN   DATA(__lc_ub_xvwbuffer)
                        570         EXTRN   DATA(__lc_ue_xvwbuffer)
                        571         CALLS   'ptvmain', 'newTThread'
                        572         CALLS   'ptvend', 'deleteTThread'
                        573         CALLS   'ptvend', 'rs232_stop'
