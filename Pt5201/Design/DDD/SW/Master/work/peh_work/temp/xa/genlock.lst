XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   1
F:\PTV\Pt5201\Design\DDD\SW\Master\work\peh_work\temp\xa\genlock.src
ADDR   CODE            LINE SOURCELINE
                          1 ; XA C compiler v2.0 r2                   SN00085795-Ccz (c) 1998 TASKING, Inc.
                          2 ; options: -A1 -Cxag3 -e -g -Ic:\cxa\include -Ic:\cxa\rtxc\xa\include -I. -Ml
                          3 ;          -O2 -s
                          5 $NOZPAGE
                          6         NAME    GENLOCK
                         10 ; genlock.c    1        /************************************************************************
                            ****/
                         11 ; genlock.c    2        /* MODULE:                                                               
                               */
                         12 ; genlock.c    3        /*  genlock.c - Genlock generator                                        
                               */
                         13 ; genlock.c    4        /************************************************************************
                            ****/
                         14 ; genlock.c    5        /* FUNCTIONS:                                                            
                               */
                         15 ; genlock.c    6        /*                                                                       
                               */
                         16 ; genlock.c    7        /*      int GenlockInit( void)                                           
                                                                                                                             
                                                                                    */
                         17 ; genlock.c    8        /*      int GenlockVersion( char* result)                                
                                                                                                                             
                                                            */
                         18 ; genlock.c    9        /*      int GenlockUpdate( void)                                         
                                                                                                                             
                                                                                    */
                         19 ; genlock.c   10        /*      int SetGenlockSystem( int system)                                
                                                                                                                             
                                                            */
                         20 ; genlock.c   11        /*      int SetGenlockDelay( UL delay)                                   
                                                                                                                             
                                                            */      
                         21 ; genlock.c   12        /*                                                                       
                               */
                         22 ; genlock.c   13        /* TASKS:                                                                
                               */
                         23 ; genlock.c   14        /*                                                                       
                               */
                         24 ; genlock.c   15        /* NOTES:                                                                
                               */
                         25 ; genlock.c   16        /*                                                                       
                               */
                         26 ; genlock.c   17        /************************************************************************
                            ****/
                         27 ; genlock.c   18        /*
                         28 ; genlock.c   19         *   PTV software for PT5201    
                         29 ; genlock.c   20         *   Copyright (c) 
                         30 ; genlock.c   21         *   ProTeleVision Technologies A/S.
                         31 ; genlock.c   22         *   ALL RIGHTS RESERVED
                         32 ; genlock.c   23        */
                         33 ; genlock.c   24        /************************************************************************
                            ****/
                         34 ; genlock.c   25        #include <string.h>
                         38 ; genlock.c   26        
                         39 ; genlock.c   27        #include "define.h"        // Standard PTV defines
                         42 ; genlock.c   28        #include "genlock.h"
                         49 ; genlock.c   29        #include "tables.h"
                         52 ; genlock.c   30        #include "led_hw.h"
                         59 ; genlock.c   31        #include "sio0drv.h"
                        392 ; genlock.c   32        #include "instru.h"
                        491 ; genlock.c   33        #include "cbar.h"
                        494 ; genlock.c   34        
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   2

ADDR   CODE            LINE SOURCELINE
                        495 ; genlock.c   35        GenlockObject GenlockSetup;
                        496 ; genlock.c   36        
                        497 ; genlock.c   37        /************************************************************************
                            **/
                        498 ; genlock.c   38        /* GenlockDefaults                                                       
                                                                                                                             
                                                            GENLOCK.C       */
                        499 ; genlock.c   39        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        500 ; genlock.c   40        /* Author:       Kim Engedahl, DEV, 000607                               
                                                                                                                             
                                            */
                        501 ; genlock.c   41        /* Revised:      000607, KEn, DEV                                        
                                                                                                                             
                                                    */
                        502 ; genlock.c   42        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        503 ; genlock.c   43        /* Function:                                                             
                                                                                                                             
                                                                                                            */
                        504 ; genlock.c   44        /* Remarks:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        505 ; genlock.c   45        /* Returns:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        506 ; genlock.c   46        /* Updates:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        507 ; genlock.c   47        /************************************************************************
                            **/
                        508 ; genlock.c   48        void GenlockDefaults( void)
                        509 ; genlock.c   49        {
000000                  510 GENLOCK_PR      SEGMENT HCODE
000000                  511         RSEG    GENLOCK_PR
                        512         ALIGN   1
                        514         PUBLIC  _GenlockDefaults
000000                  515 _GenlockDefaults:
                        519 ; genlock.c   50                Settings.GenlockSetup.System = GenlockSetup.System = Internal;
000000 964842rr         521         MOV.B   ES,#SEG( _GenlockSetup )
000004 9908rrrr         522         MOV.W   R0,#SOF( _GenlockSetup )
000008 B200             523         MOV.B   [R0],#00H
00000A 964842rr         524         MOV.B   ES,#SEG( _Settings+2 )
00000E 9908rrrr         525         MOV.W   R0,#SOF( _Settings+2 )
000012 B200             526         MOV.B   [R0],#00H
                        527 ; genlock.c   51                Settings.GenlockSetup.Delay = GenlockSetup.Delay = 0;
000014 964842rr         529         MOV.B   ES,#SEG( _GenlockSetup+2 )
000018 9908rrrr         530         MOV.W   R0,#SOF( _GenlockSetup+2 )
00001C BB00             531         MOV.W   [R0+],#00H
00001E BA00             532         MOV.W   [R0],#00H
000020 964842rr         533         MOV.B   ES,#SEG( _Settings+4 )
000024 9908rrrr         534         MOV.W   R0,#SOF( _Settings+4 )
000028 BB00             535         MOV.W   [R0+],#00H
00002A BA00             536         MOV.W   [R0],#00H
                        537 ; genlock.c   52        
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   3

ADDR   CODE            LINE SOURCELINE
                        538 ; genlock.c   53                NV_Store( &Settings, SettingsPtr, sizeof( Settings));
00002C 9918rrrr         540         MOV.W   R1,#SEG( _Settings )
000030 9908rrrr         541         MOV.W   R0,#SOF( _Settings )
000034 964842rr         542         MOV.B   ES,#SEG( _SettingsPtr )
000038 9928rrrr         543         MOV.W   R2,#SOF( _SettingsPtr )
00003C 8A22             544         MOV.W   R2,[R2]
00003E 9938004A         545         MOV.W   R3,#04AH
                        546         CALL    _NV_Store
000042 C4rrrrrr        +546 ;       FCALL   _NV_Store
                        547 ; genlock.c   54        }
000046 D680             549         RET
                        551 ; genlock.c   55        
                        552 ; genlock.c   56        /************************************************************************
                            **/
                        553 ; genlock.c   57        /* GenlockInit                                                           
                                                                                                                             
                                                              GENLOCK.C     */
                        554 ; genlock.c   58        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        555 ; genlock.c   59        /* Author:       Kim Engedahl, DEV, 000331                               
                                                                                                                             
                                            */
                        556 ; genlock.c   60        /* Revised:      000914, KEn, DEV                                        
                                                                                                                             
                                                    */
                        557 ; genlock.c   61        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        558 ; genlock.c   62        /* Function:                                                             
                                                                                                                             
                                                                                                            */
                        559 ; genlock.c   63        /* Remarks:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        560 ; genlock.c   64        /* Returns:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        561 ; genlock.c   65        /* Updates:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        562 ; genlock.c   66        /************************************************************************
                            **/
                        563 ; genlock.c   67        int GenlockInit( void)
                        564 ; genlock.c   68        {
                        565         ALIGN   1
                        567         PUBLIC  _GenlockInit
000048                  568 _GenlockInit:
                        572 ; genlock.c   69                sio0SndCommand( 12, SPG_V24_address, "GZ;");
000048 9908000C         574         MOV.W   R0,#0CH
00004C 9938rrrr         575         MOV.W   R3,#SEG( _3 )
000050 9928rrrr         576         MOV.W   R2,#SOF( _3 )
000054 0F0C             577         PUSH.W  R2, R3
000056 99180015         579         MOV.W   R1,#015H
                        580         CALL    _sio0SndCommand
00005A C4rrrrrr        +580 ;       FCALL   _sio0SndCommand
00005E A974             581         ADDS.W  R7,#04H
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   4

ADDR   CODE            LINE SOURCELINE
                        583 ; genlock.c   70        
                        584 ; genlock.c   71                sio0SndCommand( 20, SPG_V24_address, "GV%lu;", Calibration.Genloc
                            kCalibration.HPHZeroG);
000060 964842rr         586         MOV.B   ES,#SEG( _Calibration+122 )
000064 9918rrrr         587         MOV.W   R1,#SOF( _Calibration+122 )
000068 8B01             588         MOV.W   R0,[R1+]
00006A 8A11             589         MOV.W   R1,[R1]
00006C 0F03             590         PUSH.W  R0, R1
00006E 9918rrrr         592         MOV.W   R1,#SEG( _4 )
000072 9908rrrr         593         MOV.W   R0,#SOF( _4 )
000076 0F03             594         PUSH.W  R0, R1
000078 99180015         596         MOV.W   R1,#015H
00007C 99080014         597         MOV.W   R0,#014H
                        598         CALL    _sio0SndCommand
000080 C4rrrrrr        +598 ;       FCALL   _sio0SndCommand
000084 99700008         599         ADD.W   R7,#08H
                        601 ; genlock.c   72                sio0SndCommand( 20, SPG_V24_address, "GF%lu;", Calibration.Genloc
                            kCalibration.PhaseG);
000088 964842rr         603         MOV.B   ES,#SEG( _Calibration+126 )
00008C 9918rrrr         604         MOV.W   R1,#SOF( _Calibration+126 )
000090 8B01             605         MOV.W   R0,[R1+]
000092 8A11             606         MOV.W   R1,[R1]
000094 0F03             607         PUSH.W  R0, R1
000096 9918rrrr         609         MOV.W   R1,#SEG( _5 )
00009A 9908rrrr         610         MOV.W   R0,#SOF( _5 )
00009E 0F03             611         PUSH.W  R0, R1
0000A0 99180015         613         MOV.W   R1,#015H
0000A4 99080014         614         MOV.W   R0,#014H
                        615         CALL    _sio0SndCommand
0000A8 C4rrrrrr        +615 ;       FCALL   _sio0SndCommand
0000AC 99700008         616         ADD.W   R7,#08H
                        618 ; genlock.c   73        
                        619 ; genlock.c   74                sio0SndCommand( 20, SPG_V24_address, "GY%lu;", Calibration.Genloc
                            kCalibration.HPHZeroM);
0000B0 964842rr         621         MOV.B   ES,#SEG( _Calibration+130 )
0000B4 9918rrrr         622         MOV.W   R1,#SOF( _Calibration+130 )
0000B8 8B01             623         MOV.W   R0,[R1+]
0000BA 8A11             624         MOV.W   R1,[R1]
0000BC 0F03             625         PUSH.W  R0, R1
0000BE 9918rrrr         627         MOV.W   R1,#SEG( _6 )
0000C2 9908rrrr         628         MOV.W   R0,#SOF( _6 )
0000C6 0F03             629         PUSH.W  R0, R1
0000C8 99180015         631         MOV.W   R1,#015H
0000CC 99080014         632         MOV.W   R0,#014H
                        633         CALL    _sio0SndCommand
0000D0 C4rrrrrr        +633 ;       FCALL   _sio0SndCommand
0000D4 99700008         634         ADD.W   R7,#08H
                        636 ; genlock.c   75                sio0SndCommand( 20, SPG_V24_address, "GG%lu;", Calibration.Genloc
                            kCalibration.PhaseM);
0000D8 964842rr         638         MOV.B   ES,#SEG( _Calibration+134 )
0000DC 9918rrrr         639         MOV.W   R1,#SOF( _Calibration+134 )
0000E0 8B01             640         MOV.W   R0,[R1+]
0000E2 8A11             641         MOV.W   R1,[R1]
0000E4 0F03             642         PUSH.W  R0, R1
0000E6 9918rrrr         644         MOV.W   R1,#SEG( _7 )
0000EA 9908rrrr         645         MOV.W   R0,#SOF( _7 )
0000EE 0F03             646         PUSH.W  R0, R1
0000F0 99180015         648         MOV.W   R1,#015H
0000F4 99080014         649         MOV.W   R0,#014H
                        650         CALL    _sio0SndCommand
0000F8 C4rrrrrr        +650 ;       FCALL   _sio0SndCommand
0000FC 99700008         651         ADD.W   R7,#08H
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   5

ADDR   CODE            LINE SOURCELINE
                        653 ; genlock.c   76        
                        654 ; genlock.c   77                sio0SndCommand( 20, SPG_V24_address, "GX%u;", Calibration.Genlock
                            Calibration.DACUserValue);
000100 964842rr         656         MOV.B   ES,#SEG( _Calibration+120 )
000104 9908rrrr         657         MOV.W   R0,#SOF( _Calibration+120 )
000108 8A00             658         MOV.W   R0,[R0]
00010A 0F01             659         PUSH.W  R0
00010C 9918rrrr         661         MOV.W   R1,#SEG( _8 )
000110 9908rrrr         662         MOV.W   R0,#SOF( _8 )
000114 0F03             663         PUSH.W  R0, R1
000116 99080014         665         MOV.W   R0,#014H
00011A 99180015         666         MOV.W   R1,#015H
                        667         CALL    _sio0SndCommand
00011E C4rrrrrr        +667 ;       FCALL   _sio0SndCommand
000122 A976             668         ADDS.W  R7,#06H
                        670 ; genlock.c   78        
                        671 ; genlock.c   79                GenlockSetup.System = Settings.GenlockSetup.System;
000124 964842rr         673         MOV.B   ES,#SEG( _Settings+2 )
000128 9908rrrr         674         MOV.W   R0,#SOF( _Settings+2 )
00012C 8200             675         MOV.B   R0L,[R0]
00012E 964842rr         676         MOV.B   ES,#SEG( _GenlockSetup )
000132 9918rrrr         677         MOV.W   R1,#SOF( _GenlockSetup )
000136 8209             678         MOV.B   [R1],R0L
                        679 ; genlock.c   80                GenlockSetup.Delay = Settings.GenlockSetup.Delay;
000138 964842rr         681         MOV.B   ES,#SEG( _Settings+4 )
00013C 9918rrrr         682         MOV.W   R1,#SOF( _Settings+4 )
000140 8B01             683         MOV.W   R0,[R1+]
000142 8A11             684         MOV.W   R1,[R1]
000144 964842rr         685         MOV.B   ES,#SEG( _GenlockSetup+2 )
000148 9928rrrr         686         MOV.W   R2,#SOF( _GenlockSetup+2 )
00014C 8B0A             687         MOV.W   [R2+],R0
00014E 8A1A             688         MOV.W   [R2],R1
                        689 ; genlock.c   81        
                        690 ; genlock.c   82                return( 0);
000150 B900             692         MOV.W   R0,#00H
                        693 ; genlock.c   83        }
000152 D680             695         RET
                        697 ; genlock.c   84        
                        698 ; genlock.c   85        /************************************************************************
                            **/
                        699 ; genlock.c   86        /* GenlockVersion                                                        
                                                                                                                             
                                                              GENLOCK.C     */
                        700 ; genlock.c   87        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        701 ; genlock.c   88        /* Author:       Kim Engedahl, DEV, 000504                               
                                                                                                                             
                                            */
                        702 ; genlock.c   89        /* Revised:      000603, KEn, DEV                                        
                                                                                                                             
                                                    */
                        703 ; genlock.c   90        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        704 ; genlock.c   91        /* Function:                                                             
                                                                                                                             
                                                                                                            */
                        705 ; genlock.c   92        /* Remarks:                                                              
                                                                                                                             
                                                                                                                            *
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   6

ADDR   CODE            LINE SOURCELINE
                            /
                        706 ; genlock.c   93        /* Returns:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        707 ; genlock.c   94        /* Updates:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        708 ; genlock.c   95        /************************************************************************
                            **/
                        709 ; genlock.c   96        int GenlockVersion( char* result)
                        710 ; genlock.c   97        {
                        711         ALIGN   1
                        713         PUBLIC  _GenlockVersion
000154                  714 _GenlockVersion:
                        720 ; genlock.c   98                return( sio0SndRequest( 12, SPG_V24_address, result, "GI?"));
000154 9938rrrr         722         MOV.W   R3,#SEG( _9 )
000158 9928rrrr         723         MOV.W   R2,#SOF( _9 )
00015C 0F0C             724         PUSH.W  R2, R3
00015E 8931             726         MOV.W   R3,R1
000160 8920             727         MOV.W   R2,R0
000162 9908000C         728         MOV.W   R0,#0CH
000166 99180015         729         MOV.W   R1,#015H
                        730         CALL    _sio0SndRequest
00016A C4rrrrrr        +730 ;       FCALL   _sio0SndRequest
00016E A974             731         ADDS.W  R7,#04H
                        736 ; genlock.c   99        }
000170 D680             738         RET
                        740 ; genlock.c  100        
                        741 ; genlock.c  101        /************************************************************************
                            **/
                        742 ; genlock.c  102        /* GenlockUpdate                                                         
                                                                                                                             
                                                              GENLOCK.C     */
                        743 ; genlock.c  103        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        744 ; genlock.c  104        /* Author:       Kim Engedahl, DEV, 000413                               
                                                                                                                             
                                            */
                        745 ; genlock.c  105        /* Revised:      000509, KEn, DEV                                        
                                                                                                                             
                                                    */
                        746 ; genlock.c  106        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        747 ; genlock.c  107        /* Function:                                                             
                                                                                                                             
                                                                                                            */
                        748 ; genlock.c  108        /* Remarks:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        749 ; genlock.c  109        /* Returns:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        750 ; genlock.c  110        /* Updates:                                                              
                                                                                                                             
                                                                                                                            *
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   7

ADDR   CODE            LINE SOURCELINE
                            /
                        751 ; genlock.c  111        /************************************************************************
                            **/
                        752 ; genlock.c  112        int GenlockUpdate( void)
                        753 ; genlock.c  113        {
                        754         ALIGN   1
                        756         PUBLIC  _GenlockUpdate
000172                  757 _GenlockUpdate:
                        761 ; genlock.c  114                SetGenlockSystem( GenlockSetup.System);
000172 964842rr         763         MOV.B   ES,#SEG( _GenlockSetup )
000176 9908rrrr         764         MOV.W   R0,#SOF( _GenlockSetup )
00017A 8200             765         MOV.B   R0L,[R0]
00017C B110             766         MOVS.B  R0H,#00H
00017E C5000B           767         CALL    _SetGenlockSystem
                        768 ; genlock.c  115          SetGenlockDelay( GenlockSetup.Delay);
000181 964842rr         770         MOV.B   ES,#SEG( _GenlockSetup+2 )
000185 9918rrrr         771         MOV.W   R1,#SOF( _GenlockSetup+2 )
000189 8B01             772         MOV.W   R0,[R1+]
00018B 8A11             773         MOV.W   R1,[R1]
00018D C50077           774         CALL    _SetGenlockDelay
                        775 ; genlock.c  116        
                        776 ; genlock.c  117                return( OK);
000190 9908FFFF         778         MOV.W   R0,#0FFFFH
                        779 ; genlock.c  118        }
000194 D680             781         RET
                        783 ; genlock.c  119        
                        784 ; genlock.c  120        /************************************************************************
                            **/
                        785 ; genlock.c  121        /* SetGenlockSystem                                                      
                                                                                                                             
                                                      GENLOCK.C     */
                        786 ; genlock.c  122        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        787 ; genlock.c  123        /* Author:       Kim Engedahl, DEV, 000331                               
                                                                                                                             
                                            */
                        788 ; genlock.c  124        /* Revised:      000619, KEn, DEV                                        
                                                                                                                             
                                                    */
                        789 ; genlock.c  125        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        790 ; genlock.c  126        /* Function:                                                             
                                                                                                                             
                                                                                                            */
                        791 ; genlock.c  127        /* Remarks:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        792 ; genlock.c  128        /* Returns:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        793 ; genlock.c  129        /* Updates:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        794 ; genlock.c  130        /************************************************************************
                            **/
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   8

ADDR   CODE            LINE SOURCELINE
                        795 ; genlock.c  131        int SetGenlockSystem( int system)
                        796 ; genlock.c  132        {
                        797         ALIGN   1
                        799         PUBLIC  _SetGenlockSystem
000196                  800 _SetGenlockSystem:
000196 0F10             804         PUSH.W  R4
000198 A978             806         ADDS.W  R7,#08H
                        812 ; genlock.c  133                char cmd[7];
                        813 ; genlock.c  134        
                        814 ; genlock.c  135                switch ( system)
00019A 8940             816         MOV.W   R4,R0
00019C 99440000         817         CMP.W   R4,#00H
0001A0 F32D             818         BEQ     _19
0001A2 99440003         819         CMP.W   R4,#03H
0001A6 F307             820         BEQ     _15
0001A8 99440001         821         CMP.W   R4,#01H
0001AC F30F             822         BEQ     _16
0001AE 99440002         823         CMP.W   R4,#02H
0001B2 F317             824         BEQ     _17
0001B4 FE21             825         BR      _18
                        828 ; genlock.c  136                {
                        829 ; genlock.c  137                        case Internal:
                        830 ; genlock.c  138                                strcpy( cmd, "GM0;");
                        831 ; genlock.c  139                                break;
                        832 ; genlock.c  140        
                        833 ; genlock.c  141                        case MHzLock10:
0001B6                  835 _15:
                        836 ; genlock.c  142                                strcpy( cmd, "GM2;");
0001B6 9128rr           838         MOV.B   R1L,#SEG( __lc_bs )
0001B9 7133             839         XOR.B   R1H,R1H
0001BB 8907             840         MOV.W   R0,R7
0001BD 9938rrrr         841         MOV.W   R3,#SEG( _11 )
0001C1 9928rrrr         842         MOV.W   R2,#SOF( _11 )
                        843         CALL    _strcpy
0001C5 C4rrrrrr        +843 ;       FCALL   _strcpy
                        844 ; genlock.c  143                                break;
0001C9 FE23             846         BR      _22
                        847 ; genlock.c  144        
                        848 ; genlock.c  145                        case BurstLockPAL:
0001CC                  850 _16:
                        851 ; genlock.c  146                                strcpy( cmd, "GM8;");
0001CC 9128rr           853         MOV.B   R1L,#SEG( __lc_bs )
0001CF 7133             854         XOR.B   R1H,R1H
0001D1 8907             855         MOV.W   R0,R7
0001D3 9938rrrr         856         MOV.W   R3,#SEG( _12 )
0001D7 9928rrrr         857         MOV.W   R2,#SOF( _12 )
                        858         CALL    _strcpy
0001DB C4rrrrrr        +858 ;       FCALL   _strcpy
                        859 ; genlock.c  147                                break;
0001DF FE18             861         BR      _22
                        862 ; genlock.c  148        
                        863 ; genlock.c  149                        case BurstLockNTSC:
0001E2                  865 _17:
                        866 ; genlock.c  150                                strcpy( cmd, "GM10;");
0001E2 9128rr           868         MOV.B   R1L,#SEG( __lc_bs )
0001E5 7133             869         XOR.B   R1H,R1H
0001E7 8907             870         MOV.W   R0,R7
0001E9 9938rrrr         871         MOV.W   R3,#SEG( _13 )
0001ED 9928rrrr         872         MOV.W   R2,#SOF( _13 )
                        873         CALL    _strcpy
0001F1 C4rrrrrr        +873 ;       FCALL   _strcpy
                        874 ; genlock.c  151                                break;
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page   9

ADDR   CODE            LINE SOURCELINE
0001F5 FE0D             876         BR      _22
                        877 ; genlock.c  152        
                        878 ; genlock.c  153                        default:
0001F8                  880 _18:
                        881 ; genlock.c  154                                return( FAIL);
0001F8 B900             883         MOV.W   R0,#00H
0001FA FE3D             884         BR      _23
0001FC                  886 _19:
0001FC 9128rr           890         MOV.B   R1L,#SEG( __lc_bs )
0001FF 7133             891         XOR.B   R1H,R1H
000201 8907             892         MOV.W   R0,R7
000203 9938rrrr         893         MOV.W   R3,#SEG( _10 )
000207 9928rrrr         894         MOV.W   R2,#SOF( _10 )
                        895         CALL    _strcpy
00020B C4rrrrrr        +895 ;       FCALL   _strcpy
                        896 ; genlock.c  155                }
000210                  898 _22:
                        899 ; genlock.c  156        
                        900 ; genlock.c  157                Settings.ActivePreset = 0;
000210 964842rr         902         MOV.B   ES,#SEG( _Settings )
000214 9908rrrr         903         MOV.W   R0,#SOF( _Settings )
000218 BA00             904         MOV.W   [R0],#00H
                        906 ; genlock.c  158        
                        907 ; genlock.c  159                Settings.GenlockSetup.System = GenlockSetup.System = system;
00021A 964842rr         909         MOV.B   ES,#SEG( _GenlockSetup )
00021E 9908rrrr         910         MOV.W   R0,#SOF( _GenlockSetup )
000222 8288             911         MOV.B   [R0],R4L
000224 964842rr         912         MOV.B   ES,#SEG( _Settings+2 )
000228 9908rrrr         913         MOV.W   R0,#SOF( _Settings+2 )
00022C 8288             914         MOV.B   [R0],R4L
                        915 ; genlock.c  160                NV_Store( &Settings, SettingsPtr, sizeof( Settings));
00022E 9918rrrr         917         MOV.W   R1,#SEG( _Settings )
000232 9908rrrr         918         MOV.W   R0,#SOF( _Settings )
000236 964842rr         919         MOV.B   ES,#SEG( _SettingsPtr )
00023A 9928rrrr         920         MOV.W   R2,#SOF( _SettingsPtr )
00023E 8A22             921         MOV.W   R2,[R2]
000240 9938004A         922         MOV.W   R3,#04AH
                        923         CALL    _NV_Store
000244 C4rrrrrr        +923 ;       FCALL   _NV_Store
                        924 ; genlock.c  161        
                        925 ; genlock.c  162                LEDSet( GenlockLED, false);
000248 99084000         927         MOV.W   R0,#04000H
00024C B910             928         MOV.W   R1,#00H
                        929         CALL    _LEDSet
00024E C4rrrrrr        +929 ;       FCALL   _LEDSet
                        930 ; genlock.c  163                
                        931 ; genlock.c  164                return( sio0SndCommand( 12, SPG_V24_address, "%s", cmd));
000252 9908000C         933         MOV.W   R0,#0CH
000256 99180015         934         MOV.W   R1,#015H
00025A 9168rr           935         MOV.B   R3L,#SEG( __lc_bs )
00025D 7177             936         XOR.B   R3H,R3H
00025F 8927             937         MOV.W   R2,R7
000261 0F0C             938         PUSH.W  R2, R3
000263 9938rrrr         940         MOV.W   R3,#SEG( _14 )
000267 9928rrrr         941         MOV.W   R2,#SOF( _14 )
00026B 0F0C             942         PUSH.W  R2, R3
                        944         CALL    _sio0SndCommand
00026D C4rrrrrr        +944 ;       FCALL   _sio0SndCommand
000271 99700008         945         ADD.W   R7,#08H
                        947 ; genlock.c  165        }
000276                  949 _23:
000276 99700008         950         ADD.W   R7,#08H
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page  10

ADDR   CODE            LINE SOURCELINE
00027A 2F10             952         POP.W   R4
00027C D680             954         RET
                        956 ; genlock.c  166        
                        957 ; genlock.c  167        /************************************************************************
                            **/
                        958 ; genlock.c  168        /* SetGenlockDelay                                                       
                                                                                                                             
                                                            GENLOCK.C       */
                        959 ; genlock.c  169        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        960 ; genlock.c  170        /* Author:       Kim Engedahl, DEV, 000331                               
                                                                                                                             
                                            */
                        961 ; genlock.c  171        /* Revised:      000731, KEn, DEV                                        
                                                                                                                             
                                                    */
                        962 ; genlock.c  172        /*                                                                       
                                                                                                                             
                                                                                                                             
                                                    */
                        963 ; genlock.c  173        /* Function: Broadcast common delay to BB and CBar                       
                                                                                                    */
                        964 ; genlock.c  174        /* Remarks:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        965 ; genlock.c  175        /* Returns:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        966 ; genlock.c  176        /* Updates:                                                              
                                                                                                                             
                                                                                                                            *
                            /
                        967 ; genlock.c  177        /************************************************************************
                            **/
                        968 ; genlock.c  178        int SetGenlockDelay( UL delay)
                        969 ; genlock.c  179        {
                        970         ALIGN   1
                        972         PUBLIC  _SetGenlockDelay
00027E                  973 _SetGenlockDelay:
00027E 0F30             977         PUSH.W  R4, R5
                        981 ; genlock.c  180                Settings.ActivePreset = 0;
000280 964842rr         983         MOV.B   ES,#SEG( _Settings )
000284 9928rrrr         984         MOV.W   R2,#SOF( _Settings )
000288 BA20             985         MOV.W   [R2],#00H
                        986 ; genlock.c  181        
                        987 ; genlock.c  182                Settings.GenlockSetup.Delay = GenlockSetup.Delay = delay;
00028A 8951             989         MOV.W   R5,R1
00028C 8940             990         MOV.W   R4,R0
00028E 964842rr         991         MOV.B   ES,#SEG( _GenlockSetup+2 )
000292 9908rrrr         992         MOV.W   R0,#SOF( _GenlockSetup+2 )
000296 8B48             993         MOV.W   [R0+],R4
000298 8A58             994         MOV.W   [R0],R5
00029A 964842rr         997         MOV.B   ES,#SEG( _Settings+4 )
00029E 9908rrrr         998         MOV.W   R0,#SOF( _Settings+4 )
0002A2 8B48             999         MOV.W   [R0+],R4
0002A4 8A58            1000         MOV.W   [R0],R5
                       1001 ; genlock.c  183                NV_Store( &Settings, SettingsPtr, sizeof( Settings));
0002A6 9918rrrr        1003         MOV.W   R1,#SEG( _Settings )
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page  11

ADDR   CODE            LINE SOURCELINE
0002AA 9908rrrr        1004         MOV.W   R0,#SOF( _Settings )
0002AE 964842rr        1005         MOV.B   ES,#SEG( _SettingsPtr )
0002B2 9928rrrr        1006         MOV.W   R2,#SOF( _SettingsPtr )
0002B6 8A22            1007         MOV.W   R2,[R2]
0002B8 9938004A        1008         MOV.W   R3,#04AH
                       1009         CALL    _NV_Store
0002BC C4rrrrrr       +1009 ;       FCALL   _NV_Store
                       1010 ; genlock.c  184        
                       1011 ; genlock.c  185                sio0SndCommand( 20, BB_V24_address, "HO%lu;", delay);
0002C0 8915            1013         MOV.W   R1,R5
0002C2 8904            1014         MOV.W   R0,R4
0002C4 0F03            1017         PUSH.W  R0, R1
0002C6 9918rrrr        1020         MOV.W   R1,#SEG( _24 )
0002CA 9908rrrr        1021         MOV.W   R0,#SOF( _24 )
0002CE 0F03            1022         PUSH.W  R0, R1
0002D0 99180034        1024         MOV.W   R1,#034H
0002D4 99080014        1025         MOV.W   R0,#014H
                       1026         CALL    _sio0SndCommand
0002D8 C4rrrrrr       +1026 ;       FCALL   _sio0SndCommand
0002DC 99700008        1027         ADD.W   R7,#08H
                       1029 ; genlock.c  186                sio0SndCommand( 20, BB_V24_address, "JO%lu;", delay);
0002E0 8915            1031         MOV.W   R1,R5
0002E2 8904            1032         MOV.W   R0,R4
0002E4 0F03            1034         PUSH.W  R0, R1
0002E6 9918rrrr        1037         MOV.W   R1,#SEG( _25 )
0002EA 9908rrrr        1038         MOV.W   R0,#SOF( _25 )
0002EE 0F03            1039         PUSH.W  R0, R1
0002F0 99180034        1041         MOV.W   R1,#034H
0002F4 99080014        1042         MOV.W   R0,#014H
                       1043         CALL    _sio0SndCommand
0002F8 C4rrrrrr       +1043 ;       FCALL   _sio0SndCommand
0002FC 99700008        1044         ADD.W   R7,#08H
                       1046 ; genlock.c  187                sio0SndCommand( 20, BB_V24_address, "KO%lu;", delay);
000300 0F30            1048         PUSH.W  R4, R5
000302 9918rrrr        1050         MOV.W   R1,#SEG( _26 )
000306 9908rrrr        1051         MOV.W   R0,#SOF( _26 )
00030A 0F03            1052         PUSH.W  R0, R1
00030C 99180034        1054         MOV.W   R1,#034H
000310 99080014        1055         MOV.W   R0,#014H
                       1056         CALL    _sio0SndCommand
000314 C4rrrrrr       +1056 ;       FCALL   _sio0SndCommand
000318 99700008        1057         ADD.W   R7,#08H
                       1059 ; genlock.c  188        
                       1060 ; genlock.c  189                SetCBDelay( CBSetup.Delay);     // The delay routine also takes t
                            he genlock
00031C 964842rr        1062         MOV.B   ES,#SEG( _CBSetup+4 )
000320 9918rrrr        1063         MOV.W   R1,#SOF( _CBSetup+4 )
000324 8B01            1064         MOV.W   R0,[R1+]
000326 8A11            1065         MOV.W   R1,[R1]
                       1066         CALL    _SetCBDelay
000328 C4rrrrrr       +1066 ;       FCALL   _SetCBDelay
                       1067 ; genlock.c  190                                                                                 
                                                                            //  offset into account.                         
                                                                                                                             
                                                            
                       1068 ; genlock.c  191                return( OK);
00032C 9908FFFF        1070         MOV.W   R0,#0FFFFH
                       1071 ; genlock.c  192        }
000330 2F30            1073         POP.W   R4, R5
000332 D680            1075         RET
                       1081         EXTRN   HCODE(_SetCBDelay)
000000                 1082 GENLOCK_INI_FA  SEGMENT HDATA INSEGMENT INIT
XA assembler v2.0 r2                    SN00085795-037 (c) 1998 TASKING, Inc.
                                                                                                                            Page  12

ADDR   CODE            LINE SOURCELINE
000000                 1083         RSEG    GENLOCK_INI_FA
000000 474D383B00      1084 _12:    DB      047H,04DH,038H,03BH,000H
000005 4747256C753B00  1085 _7:     DB      047H,047H,025H,06CH,075H,03BH,000H
                       1088         EXTRN   HCODE(_sio0SndCommand)
00000C 4B4F256C753B00  1089 _26:    DB      04BH,04FH,025H,06CH,075H,03BH,000H
000013 4746256C753B00  1090 _5:     DB      047H,046H,025H,06CH,075H,03BH,000H
00001A 484F256C753B00  1091 _24:    DB      048H,04FH,025H,06CH,075H,03BH,000H
000021 47493F00        1092 _9:     DB      047H,049H,03FH,000H
                       1094         EXTRN   HDATA(_CBSetup)
000025 257300          1095 _14:    DB      025H,073H,000H
                       1098         EXTRN   HCODE(_LEDSet)
                       1101         EXTRN   HCODE(_strcpy)
000028 474D303B00      1102 _10:    DB      047H,04DH,030H,03BH,000H
                       1104         EXTRN   HDATA(_SettingsPtr)
00002D 475A3B00        1105 _3:     DB      047H,05AH,03BH,000H
000031 475825753B00    1106 _8:     DB      047H,058H,025H,075H,03BH,000H
000000                 1109 GENLOCK_CLR_FA  SEGMENT HDATA INSEGMENT CLEAR
000000                 1110         RSEG    GENLOCK_CLR_FA
                       1111         PUBLIC  _GenlockSetup
                       1112         ALIGN   1
000000                 1113 _GenlockSetup:  DS      6
   |  RESERVED             
000005
                       1115         EXTRN   HDATA(_Settings)
                       1118         EXTRN   HCODE(_NV_Store)
000037                 1119         RSEG    GENLOCK_INI_FA
000037 474D323B00      1120 _11:    DB      047H,04DH,032H,03BH,000H
00003C 4A4F256C753B00  1121 _25:    DB      04AH,04FH,025H,06CH,075H,03BH,000H
                       1123         EXTRN   HDATA(_Calibration)
000043 4756256C753B00  1124 _4:     DB      047H,056H,025H,06CH,075H,03BH,000H
                       1125         EXTRN   IDATA(__lc_bs)
00004A 4759256C753B00  1126 _6:     DB      047H,059H,025H,06CH,075H,03BH,000H
000051 474D31303B00    1127 _13:    DB      047H,04DH,031H,030H,03BH,000H
                       1130         EXTRN   HCODE(_sio0SndRequest)
                       1131         EXTRN   DATA(__lc_ub_xvwbuffer)
                       1132         EXTRN   DATA(__lc_ue_xvwbuffer)
                       1133         CALLS   'GenlockDefaults', 'NV_Store'
                       1134         CALLS   'GenlockInit', 'sio0SndCommand'
                       1135         CALLS   'GenlockVersion', 'sio0SndRequest'
                       1136         CALLS   'GenlockUpdate', 'SetGenlockSystem'
                       1137         CALLS   'GenlockUpdate', 'SetGenlockDelay'
                       1138         CALLS   'SetGenlockSystem', 'strcpy'
                       1139         CALLS   'SetGenlockSystem', 'NV_Store'
                       1140         CALLS   'SetGenlockSystem', 'LEDSet'
                       1141         CALLS   'SetGenlockSystem', 'sio0SndCommand'
                       1142         CALLS   'SetGenlockDelay', 'NV_Store'
                       1143         CALLS   'SetGenlockDelay', 'sio0SndCommand'
                       1144         CALLS   'SetGenlockDelay', 'SetCBDelay'
